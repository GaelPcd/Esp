<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Construir una balsa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background:#111;
  color:#fff;
  margin:0;
}
h1 { margin-top:15px; }

#timer {
    font-size:22px; 
    margin: 15px 0;
    color: #ff4757;
    font-weight: bold;
}

#grid {
  display: inline-grid;
  gap: 2px;
  margin-top:10px;
  touch-action:none;
}

.cell {
  width:34px;
  height:34px;
  background:#222;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size:18px;
  user-select:none;
}
.cell.selected { background:#0a84ff; }
.cell.found { background:#2ecc71; }
.cell.selectedFound { background:#0a84ff; } /* bleu si s√©lection d'une lettre trouv√©e */

button {
  margin-top:15px;
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:6px;
  background:#444;
  color:white;
}

#reward {
  display:none;
  margin-top:25px;
  font-size:22px;
  color:#ffd700;
}
</style>
</head>
<body>

<h1>üîé Encuentra las palabras para construir tu balsa.</h1>

<div id="timer">‚è≥ Temps restant : 05:00</div>

<div id="grid"></div>

<button onclick="resetSelection()">‚ùå Borrar selecci√≥n</button>

<div id="reward">üéâ Has encontrado todas las palabras! Conjugad los verbos.</div>

<script>
// ====== CHRONO ======
let timeLeft = 300; // 5 minutes
let timerElement = document.getElementById("timer");
let gameOver = false;
let timerInterval;

function startTimer(){
  timerInterval = setInterval(()=>{
    if(timeLeft <= 0){
      clearInterval(timerInterval);
      timerElement.textContent = "‚è∞ Tiempo transcurrido...";
      gameOver = true;
      return;
    }
    timeLeft--;
    let minutes = String(Math.floor(timeLeft / 60)).padStart(2,'0');
    let seconds = String(timeLeft % 60).padStart(2,'0');
    timerElement.textContent = `‚è≥ Tiempo restante : ${minutes}:${seconds}`;
  },1000);
}
startTimer();

// ====== GRILLE ET MOTS ======
const words = ["VELA","CUERDA","MARTILLO","CUCHILLO","BARRIL","MADERA"];
const gridSize = 12;

const alphabet="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
let grid=[...Array(gridSize)].map(()=>Array(gridSize).fill(""));

// directions sens direct uniquement
const directions = [
  [0,1],   // horizontal
  [1,0],   // vertical
  [1,1],   // diagonale descendante
  [-1,1]   // diagonale montante
];

// place les mots dans la grille
function placeWord(word){
  for(let attempts=0; attempts<100; attempts++){
    let dir = directions[Math.floor(Math.random()*directions.length)];
    let row = Math.floor(Math.random()*gridSize);
    let col = Math.floor(Math.random()*gridSize);

    let fits=true;
    for(let i=0;i<word.length;i++){
      let r=row + dir[0]*i;
      let c=col + dir[1]*i;
      if(r<0||r>=gridSize||c<0||c>=gridSize) {fits=false; break;}
      if(grid[r][c]!="" && grid[r][c]!=word[i]) {fits=false; break;}
    }

    if(fits){
      for(let i=0;i<word.length;i++){
        let r=row + dir[0]*i;
        let c=col + dir[1]*i;
        grid[r][c]=word[i];
      }
      return true;
    }
  }
  return false;
}

words.forEach(w=>placeWord(w));

// Remplit le reste al√©atoirement
for(let i=0;i<gridSize;i++){
  for(let j=0;j<gridSize;j++){
    if(grid[i][j]==""){
      grid[i][j]=alphabet[Math.floor(Math.random()*alphabet.length)];
    }
  }
}

// ====== AFFICHAGE ======
const gridDiv=document.getElementById("grid");
gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, 34px)`;

let foundWords=[];
let selectedCells=[];
let currentDirection=null;
let isTouching=false;

function renderGrid(){
  gridDiv.innerHTML="";
  for(let i=0;i<gridSize;i++){
    for(let j=0;j<gridSize;j++){
      const div=document.createElement("div");
      div.className="cell";
      div.textContent=grid[i][j];
      div.dataset.row=i;
      div.dataset.col=j;

      // clic
      div.addEventListener("click", ()=>selectCell(div));
      // tactile
      div.addEventListener("touchstart",(e)=>{
        e.preventDefault(); isTouching=true; selectCell(div);
      });
      div.addEventListener("touchmove",(e)=>{
        e.preventDefault();
        if(!isTouching) return;
        let t=e.touches[0];
        let target=document.elementFromPoint(t.clientX,t.clientY);
        if(target && target.classList.contains("cell")){
          selectCell(target);
        }
      });
      div.addEventListener("touchend",()=>isTouching=false);

      gridDiv.appendChild(div);
    }
  }
}
renderGrid();

// ====== LOGIQUE DE S√âLECTION ======
function isNeighbor(c1,c2){
  let r1=parseInt(c1.dataset.row);
  let c1c=parseInt(c1.dataset.col);
  let r2=parseInt(c2.dataset.row);
  let c2c=parseInt(c2.dataset.col);
  return Math.abs(r1-r2)<=1 && Math.abs(c1c-c2c)<=1;
}

function getDirection(c1,c2){
  return [c2.dataset.row-c1.dataset.row, c2.dataset.col-c1.dataset.col];
}

function selectCell(cell){
  if(gameOver) return;
  if(selectedCells.includes(cell)) return;

  const isFound = cell.classList.contains("found");

  if(selectedCells.length===0){
    if(isFound) cell.classList.add("selectedFound");
    else cell.classList.add("selected");
    selectedCells.push(cell);
    currentDirection=null;
    return;
  }

  let last=selectedCells[selectedCells.length-1];
  if(!isNeighbor(last,cell)) return;

  if(selectedCells.length===1){
    currentDirection=getDirection(last,cell);
  } else {
    let newDir=getDirection(last,cell);
    if(newDir[0]!=currentDirection[0] || newDir[1]!=currentDirection[1]) return;
  }

  if(isFound) cell.classList.add("selectedFound");
  else cell.classList.add("selected");
  selectedCells.push(cell);
  checkSelection();
}

function checkSelection(){
  let word = selectedCells.map(c=>c.textContent).join("");
  if(words.includes(word)){
    selectedCells.forEach(c=>{
      c.classList.remove("selected", "selectedFound");
      c.classList.add("found");
    });
    foundWords.push(word);
    resetSelection();
    checkWin();
  }
}

function resetSelection(){
  selectedCells.forEach(c=>{
    if(c.classList.contains("selectedFound")){
      c.classList.remove("selectedFound");
      c.classList.add("found");
    } else {
      c.classList.remove("selected");
    }
  });
  selectedCells=[];
  currentDirection=null;
}

function checkWin(){
  if(foundWords.length===words.length){
    document.getElementById("reward").style.display="block";
    gameOver = true;
    clearInterval(timerInterval);
  }
}
</script>

</body>
</html>
